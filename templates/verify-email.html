{{define "verify-email-content"}}
<!-- Loading State -->
<div id="loadingState" class="verify-state loading-state">
    <div class="state-content">
        <div class="spinner-large"></div>
        <h3>Verificando tu email...</h3>
        <p>Por favor espera mientras verificamos tu cuenta.</p>
    </div>
</div>

<!-- Success State -->
<div id="successState" class="verify-state success-state" style="display: none;">
    <div class="state-content">
        <div class="state-icon success-icon">✓</div>
        <h3>¡Cuenta activada!</h3>
        <p>Tu cuenta ha sido verificada exitosamente.</p>
        <p class="sub-text">Ya puedes iniciar sesión con tu email y contraseña.</p>
        <button type="button" class="btn action-button" onclick="goToLogin()">
            Iniciar Sesión
        </button>
    </div>
</div>

<!-- Error State -->
<div id="errorState" class="verify-state error-state" style="display: none;">
    <div class="state-content">
        <div class="state-icon error-icon">✕</div>
        <h3>Error de verificación</h3>
        <p id="errorMessage">Token inválido o expirado.</p>
        <button type="button" class="btn btn-secondary action-button" onclick="goToLogin()">
            Volver al Login
        </button>
    </div>
</div>

<script>
    const token = '{{.Token}}';
    const appID = '{{.AppID}}';

    // Auto-verify on page load
    window.addEventListener('DOMContentLoaded', function() {
        verifyEmail();
    });

    async function verifyEmail() {
        if (!token) {
            showError('Token de verificación no válido');
            return;
        }

        try {
            const response = await fetch('/api/v1/auth/verify-email', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ token: token })
            });

            const data = await response.json();

            if (response.ok) {
                showSuccess();
            } else {
                showError(data.error || data.message || 'Token inválido o expirado');
            }
        } catch (error) {
            console.error('Error verifying email:', error);
            showError('Error de conexión. Inténtalo más tarde.');
        }
    }

    function showSuccess() {
        document.getElementById('loadingState').style.display = 'none';
        document.getElementById('successState').style.display = 'flex';

        // Auto-redirect after 3 seconds
        setTimeout(() => {
            goToLogin();
        }, 3000);
    }

    function showError(message) {
        document.getElementById('loadingState').style.display = 'none';
        document.getElementById('errorState').style.display = 'flex';
        document.getElementById('errorMessage').textContent = message;
    }

    function goToLogin() {
        window.location.href = `/auth/login?app_id=${appID}`;
    }
</script>

<style>
    .verify-state {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 200px;
    }

    .state-content {
        text-align: center;
        padding: 2rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
    }

    .spinner-large {
        border: 4px solid #f3f3f3;
        border-top: 4px solid {{.PrimaryColor}};
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite;
    }

    .state-icon {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 48px;
        font-weight: bold;
        margin-bottom: 0.5rem;
    }

    .success-icon {
        background: #10b981;
        color: white;
    }

    .error-icon {
        background: #ef4444;
        color: white;
    }

    .verify-state h3 {
        margin: 0;
        color: #1f2937;
        font-size: 24px;
        font-weight: 600;
    }

    .verify-state p {
        margin: 0;
        color: #6b7280;
        line-height: 1.5;
    }

    .sub-text {
        font-size: 0.9rem;
        margin-top: 0.5rem !important;
    }

    .action-button {
        margin-top: 1rem;
        min-width: 200px;
    }

    .btn-secondary {
        background: #6b7280;
    }

    .btn-secondary:hover {
        background: #4b5563;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>
{{end}}
